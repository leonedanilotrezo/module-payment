define(["underscore","jquery","ko","Dholi_Payment/js/payment","Magento_Checkout/js/model/quote","Dholi_Payment/js/payform","Dholi_Payment/js/checkout","Magento_Checkout/js/action/get-totals","Magento_Checkout/js/model/full-screen-loader"],function(h,e,j,b,a,f,g,d,i){let couponCode=j.observable(null);return b.extend({defaults:{creditCardBrand:"",creditCardBrandIcon:"",creditCardExpiry:"",creditCardCvv:"",creditCardNumber:"",creditCardNumberStatus:"",creditCardExpiryStatus:"",creditCardCvvStatus:""},installments:j.observableArray(),initialize:function(){this._super();let self=this;this.creditCardNumber.subscribe(function(k){self.creditCardNumberStatusListen(k);self.paymentErrors((self.creditCardNumberStatus()!=""?e.mage.__("Invalid Credit Card Number"):""))});couponCode.subscribe(function(){self.clearCreditCardInfo()},null,"change");a.paymentMethod.subscribe(function(){self.clearCreditCardInfo()},null,"change");a.shippingMethod.subscribe(function(){self.clearCreditCardInfo()},null,"change")},clearCreditCardInfo:function(){this.creditCardNumber("");this.creditCardBrand("");this.creditCardBrandIcon("");this.creditCardExpiry("");this.creditCardCvv("");this.installments.removeAll()},initObservable:function(){this._super().observe(["creditCardBrand","creditCardBrandIcon","creditCardNumber","creditCardExpiry","creditCardCvv","installments","creditCardNumberStatus","creditCardExpiryStatus","creditCardCvvStatus","injectPaymentBehavior"]);return this},creditCardNumberStatusListen:function(k){let c=this.status.INITIAL;if(k){let cardType=f.parseCardType(k);if(cardType){this.creditCardBrand(cardType);let cardLength=f.lengthFromType(cardType);let l=k.match(/[0-9]+/g).join([]).length;if(cardLength.indexOf(l)>-1){let isValid=f.validateCardNumber(k);if(isValid){c=this.status.SUCCESS}else{c=this.status.ERROR}}}if(this.isShowCreditCardBrandIcon()){let iconUrl=window.checkoutConfig.payment[this.getCode()].icons.brands[this.creditCardBrand()];if(iconUrl!==undefined){this.creditCardBrandIcon(iconUrl)}}}this.creditCardNumberStatus(c)},creditCardExpiryStatusListen:function(){let c=this.status.INITIAL;let value=this.creditCardExpiry();if(value){let expiryObj=f.parseCardExpiry(value);let isValid=f.validateCardExpiry(expiryObj);if(isValid){c=this.status.SUCCESS}else{c=this.status.ERROR}}this.creditCardExpiryStatus(c)},creditCardCvvStatusListen:function(){let c=this.status.INITIAL;let value=this.creditCardCvv();if(value){let isValid=f.validateCardCVC(value,this.creditCardBrand);if(isValid){c=this.status.SUCCESS}else{c=this.status.ERROR}}this.creditCardCvvStatus(c)},getVaultCode:function(){return window.checkoutConfig.payment[this.getCode()].ccVaultCode},injectPaymentBehavior:function(){let number=document.getElementById(this.getCode().concat("_number"));let expiry=document.getElementById(this.getCode().concat("_expiry"));let cvv=document.getElementById(this.getCode().concat("_cvv"));f.cardNumberInput(number);f.expiryInput(expiry);f.cvcInput(cvv)},getTotalOrderAmountForInstallments:function(){return g.getTotalOrderAmountForInstallments()},getFirstInstallmentAmount:function(){return g.getFirstInstallmentAmount()},getTotalInstallments:function(){return g.getTotalInstallments()},getMinInstallment:function(){return g.getMinInstallment()},getPercentualDiscount:function(){return g.getPercentualDiscount()},getInstallmentsUrl:function(){return g.getInstallmentsUrl()},isShowCreditCardBrandIcon:function(){return window.checkoutConfig.payment[this.getCode()].icons.show},reloadTotals:function(){let self=this;i.startLoader();e.ajax({dataType:"json",method:"POST",data:{"payment[method]":a.paymentMethod().method,"payment[cc_installments]":e("#".concat(self.getCode()).concat("_installments")).val(),"payment[shipping_amount]":this.getShippingAmount()},url:this.getPaymentUrl(),context:document.body}).done(function(k){d([],e.Deferred())}).fail().always(function(){i.stopLoader()})},getCvvImageUrl:function(){return window.checkoutConfig.payment[this.getCode()].url.cvv},getCvvImageHtml:function(){return'<img src="'+this.getCvvImageUrl()+'" alt="'+e.mage.__("Card Verification Number Visual Reference")+'" title="'+e.mage.__("Card Verification Number Visual Reference")+'" />'}})});